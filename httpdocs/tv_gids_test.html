<!DOCTYPE html>
<html>
<head>
    <title>tv gids HB test</title>

        <script src="//cmp-loader.choice.faktor.io/O1TI0E.js"></script>

<script>
    //load prebid
(function() {
    var mspb = document.createElement('script');
    mspb.async = true;
    mspb.type = 'text/javascript';
    var useSSL = 'https:' == document.location.protocol;
    mspb.src = (useSSL ? 'https:' : 'http:') +
    //    '//acdn.adnxs.com/prebid/not-for-prod/1/prebid.js'
        '//massariuscdn.com/prod/prebid.js';
    var node = document.getElementsByTagName('script')[0];
    node.parentNode.insertBefore(mspb, node);
})();

//load gpt
(function() {
    var gads = document.createElement('script');
    gads.async = true;
    gads.type = 'text/javascript';
    var useSSL = 'https:' == document.location.protocol;
    gads.src = (useSSL ? 'https:' : 'http:') +
        '//www.googletagservices.com/tag/js/gpt.js';
    var node = document.getElementsByTagName('script')[0];
    node.parentNode.insertBefore(gads, node);
})();

//define sizes eligible to serve for desktop & mobile
var HeaderDesktopSizes = [[728, 90],[970, 250],[970,90],[1800,1000],[970,1000]]
var HeaderMobileSizes = [[300,250],[320,240],[320,100],[320,50],[300,100],[300,50]]
var MPU1DesktopSizes = [[300,250],[300,600]]
var MPU1MobileSizes = [[300,250],[300,600],[320,240],[320,100],[320,50],[300,100],[300,50]]
var MPU2DesktopSizes = [[300,250],[300,600]]
var MPU2MobileSizes = [[300,250],[300,600],[320,240],[320,100],[320,50],[300,100],[300,50]]
var SkyDesktopSizes = [[120,600], [160,600]]
var SkyMobileSizes = []
//var SkyMobileSizes = [[300,250],[300,600],[320,240],[320,100],[320,50],[300,100],[300,50]]     
var BTFDesktopSizes = [[728,90]]
var BTFMobileSizes = [[300,250],[300,600],[320,240],[320,100],[320,50],[300,100],[300,50]]

//call the right sizes based on viewport
if (window.screen.availWidth > 768) {
    HeaderSizes = HeaderDesktopSizes
    MPU1Sizes = MPU1DesktopSizes
    MPU2Sizes = MPU2DesktopSizes
    SkySizes = SkyDesktopSizes
    BTFSizes = BTFDesktopSizes
} else {
    HeaderSizes = HeaderMobileSizes
    MPU1Sizes = MPU1MobileSizes
    MPU2Sizes = MPU2MobileSizes
    SkySizes = SkyMobileSizes
    BTFSizes = BTFMobileSizes                
}


var PREBID_TIMEOUT = 1200; //time bidders have to respond
var FAILSAFE_TIMEOUT = PREBID_TIMEOUT * 2; //if all fails or prebid doesn't load, call DFP without bids this time
var msCorrection = 1.3; //multiply bidders' bids to put pressure on AdX in Ad Manager

//define bidders per adslot
var adUnits = [
        ///13436254/TVGids.tv_ROS_Header
        {
            code: '/13436254/TVGids.tv_ROS_Header',
            mediaTypes: {
                banner: {
                    sizes: HeaderSizes //HeaderSizes differs per viewport
                }
            },
            bids: [{
                    bidder: 'improvedigital', //define bidder or alias name
                    labelAny: ['desktop', 'tablet'],    //this placement should only be called if it meets criteria 
                                                        //for tablet or desktop as defined in pbjs.setConfig.SizeConfig()
                    params: {
                        placementId: '1191015', //improve placement id
                        keyValues: {
                            hb: ['true'] //add a keyvalue - this will be used to exclude tag-based and other campaings that should not run over HB
                        }
                    }
                },
                {
                    bidder: 'improvedigital',
                    labelAny: ['phone'], //This placement ID will be called when it meets criteria for phone
                    params: {
                        placementId: '1191040',
                        keyValues: {
                            hb: ['true']
                        }
                    }
                },
                {
                    bidder: 'pubmatic',
                    labelAny: ['desktop', 'tablet'],
                    params: {
                        publisherId: '156546',
                        adSlot: '1636322'
                    }
                },
                {
                    bidder: 'pubmatic',
                    labelAny: ['phone'],
                    params: {
                        publisherId: '156546',
                        adSlot: '1637056'
                    }
                },  
                {
                    bidder: 'openx',
                    labelAny: ['desktop', 'tablet'],
                    params: {
                        unit: '540447395',
                        delDomain: 'massarius-d.openx.net'
                    }
                },            
                {
                    bidder: 'openx',
                    labelAny: ['phone'],
                    params: {
                        unit: '540551649',
                        delDomain: 'massarius-d.openx.net'
                    }
                },
                {
                    bidder: 'tmp1',
                    labelAny: ['desktop','tablet'],
                    params: {
                        placementId: '13894921'
                    }
                },
                {
                    bidder: 'tmp1',
                    labelAny: ['phone'],
                    params: {
                        placementId: '13896325'
                    }
                },                            
                {
                    bidder: 'tmp2',
                    labelAny: ['desktop','tablet'],
                    params: {
                        placementId: '14462444'
                    }
                },
                {
                    bidder: 'tmp2',
                    labelAny: ['phone'],
                    params: {
                        placementId: '14462445'
                    }
                },
                {
                    bidder: 'weborama',
                    labelAny: ['desktop'],
                    params: {
                        placementId: '12056169',
                    }
                },
                {
            bidder: 'justpremium',
            params: {
              zone: 65790
                }
            }
            ]
        },


        ///13436254/TVGids.tv_ROS_MPU1
        {
            code: '/13436254/TVGids.tv_ROS_MPU1',
            mediaTypes: {
                banner: {
                    sizes: MPU1Sizes
                }
            },
            bids: [{
                    bidder: 'improvedigital',
                    labelAny: ['desktop', 'tablet'],
                    params: {
                        placementId: '1191017',
                        keyValues: {
                            hb: ["true"]
                        }
                    }
                },
                {
                    bidder: 'improvedigital',
                    labelAny: ['phone'],
                    params: {
                        placementId: '1191041',
                        keyValues: {
                            hb: ["true"]
                        }
                    }
                },
                {
                    bidder: 'pubmatic',
                    labelAny: ['desktop', 'tablet'],
                    params: {
                        publisherId: '156546',
                        adSlot: '1636322'
                    }
                },
                {
                    bidder: 'pubmatic',
                    labelAny: ['phone'],
                    params: {
                        publisherId: '156546',
                        adSlot: '1637056'
                    }
                },
                {
                    bidder: 'openx',
                    labelAny: ['desktop', 'tablet'],
                    params: {
                        unit: '540447398',
                        delDomain: 'massarius-d.openx.net'
                    }
                },                            
                {
                    bidder: 'openx',
                    labelAny: ['phone'],
                    params: {
                        unit: '540551635',
                        delDomain: 'massarius-d.openx.net'
                    }
                },
                {
                    bidder: 'tmp1',
                    labelAny: ['desktop','tablet'],
                    params: {
                        placementId: '13894921'
                    }
                },
                {
                    bidder: 'tmp1',
                    labelAny: ['phone'],
                    params: {
                        placementId: '13896325'
                    }
                },                            
                {
                    bidder: 'tmp2',
                    labelAny: ['desktop','tablet'],
                    params: {
                        placementId: '14462444'
                    }
                },
                {
                    bidder: 'tmp2',
                    labelAny: ['phone'],
                    params: {
                        placementId: '14462445'
                    }
                }
            ]
        },


        ///13436254/TVGids.tv_ROS_MPU2
        {
            code: '/13436254/TVGids.tv_ROS_MPU2',
            mediaTypes: {
                banner: {
                    sizes: MPU2Sizes
                }
            },
                bids: [{
                        bidder: 'improvedigital',
                        labelAny: ['desktop', 'tablet'],
                        params: {
                            placementId: '1191023',
                            keyValues: {
                                hb: ['true']
                            }
                        }
                    },
                    {
                        bidder: 'improvedigital',
                        labelAny: ['phone'],
                        params: {
                            placementId: '1191044',
                            keyValues: {
                                hb: ['true']
                            }
                        }
                    },
                    {
                        bidder: 'pubmatic',
                        labelAny: ['desktop', 'tablet'],
                        params: {
                            publisherId: '156546',
                            adSlot: '1636322'
                        }
                    },
                    {
                        bidder: 'pubmatic',
                        labelAny: ['phone'],
                        params: {
                            publisherId: '156546',
                            adSlot: '1637056'
                        }
                    },
                    {
                        bidder: 'openx',
                        labelAny: ['desktop', 'tablet'],
                        params: {
                            unit: '540447402',
                            delDomain: 'massarius-d.openx.net'
                        }
                    },                                
                    {
                        bidder: 'openx',
                        labelAny: ['phone'],
                        params: {
                            unit: '540551640',
                            delDomain: 'massarius-d.openx.net'
                        }
                    },
                    {
                        bidder: 'tmp1',
                        labelAny: ['desktop','tablet'],
                        params: {
                            placementId: '13894921'
                        }
                    },
                    {
                        bidder: 'tmp1',
                        labelAny: ['phone'],
                        params: {
                            placementId: '13896325'
                        }
                    },                            
                    {
                        bidder: 'tmp2',
                        labelAny: ['desktop','tablet'],
                        params: {
                            placementId: '14462444'
                        }
                    },
                    {
                        bidder: 'tmp2',
                        labelAny: ['phone'],
                        params: {
                            placementId: '14462445'
                        }
                    }
                ]
            },

            ///13436254/TVGids.tv_ROS_Sky
            {
                code: '/13436254/TVGids.tv_ROS_Sky',
                mediaTypes: {
                    banner: {
                        sizes: SkySizes
                    }
                },
                bids: [{
                        bidder: 'improvedigital',
                        labelAny: ['desktop', 'tablet'],
                        params: {
                            placementId: '1191025',
                            keyValues: {
                                hb: ['true']
                            }
                        }
                    },
                    {
                        bidder: 'pubmatic',
                        labelAny: ['desktop', 'tablet'],
                        params: {
                            publisherId: '156546',
                            adSlot: '1636322'
                        }
                    },
                    {
                        bidder: 'openx',
                        labelAny: ['desktop', 'tablet'],
                        params: {
                            unit: '540447408',
                            delDomain: 'massarius-d.openx.net'
                        }
                    },
                    {
                        bidder: 'tmp1',
                        labelAny: ['desktop','tablet'],
                        params: {
                            placementId: '13894921'
                        }
                    },                          
                    {
                        bidder: 'tmp2',
                        labelAny: ['desktop','tablet'],
                        params: {
                            placementId: '14462444'
                        }
                    },
                ]
                },

                ///13436254/TVGids.tv_ROS_BTF
                {
                    code: '/13436254/TVGids.tv_ROS_BTF',
                    mediaTypes: {
                        banner: {
                            sizes: BTFSizes
                        }
                    },
                    bids: [{
                        bidder: 'improvedigital',
                        labelAny: ['desktop', 'tablet'],
                        params: {
                            placementId: '1191024',
                            keyValues: {
                                hb: ['true']
                            }
                        }
                    },
                    {
                        bidder: 'improvedigital',
                        labelAny: ['phone'],
                        params: {
                            placementId: '1191045',
                            keyValues: {
                                hb: ['true']
                            }
                        }
                    },
                    {
                        bidder: 'pubmatic',
                        labelAny: ['desktop', 'tablet'],
                        params: {
                            publisherId: '156546',
                            adSlot: '1636322'
                        }
                    },
                    {
                        bidder: 'pubmatic',
                        labelAny: ['phone'],
                        params: {
                            publisherId: '156546',
                            adSlot: '1637056'
                        }
                    },
                    {
                        bidder: 'openx',
                        labelAny: ['desktop', 'tablet'],
                        params: {
                            unit: '540447406',
                            delDomain: 'massarius-d.openx.net'
                        }
                    },                                
                    {
                        bidder: 'openx',
                        labelAny: ['phone'],
                        params: {
                            unit: '540551635',
                            delDomain: 'massarius-d.openx.net'
                        }
                    },
                    {
                        bidder: 'tmp1',
                        labelAny: ['desktop','tablet'],
                        params: {
                            placementId: '13894921'
                        }
                    },
                    {
                        bidder: 'tmp1',
                        labelAny: ['phone'],
                        params: {
                            placementId: '13896325'
                        }
                    },                       
                    {
                        bidder: 'tmp2',
                        labelAny: ['desktop','tablet'],
                        params: {
                            placementId: '14462444'
                        }
                    },
                    {
                        bidder: 'tmp2',
                        labelAny: ['phone'],
                        params: {
                            placementId: '14462445'
                        }
                    }
                    ]
                }];


            var googletag = googletag || {};
            googletag.cmd = googletag.cmd || [];
            googletag.cmd.push(function() {
                googletag.pubads().disableInitialLoad(); //pause the ad server until bids are back
            });

     var pbjs = pbjs || {};
     pbjs.que = pbjs.que || [];
     pbjs.que.push(function() {
        pbjs.setConfig({
          consentManagement: {
            cmpApi: 'iab',
            timeout: 8000,
            allowAuctionWithoutConsent: false
          }
        });
        pbjs.addAdUnits(adUnits);
     });
            pbjs.bidderSettings = {
                improvedigital: {
                    bidCpmAdjustment: function(bidCpm) {
                        return bidCpm * msCorrection * 1;  //standard adjustment assuming this bidder:
                                                                //bids net & in EUR
                    }
                },
                tmp1: {
                    bidCpmAdjustment: function(bidCpm) { 
                        return bidCpm * 1.3;                    //Standard TMP adjustment * 1.3
                    }
                },
                tmp2: {
                    bidCpmAdjustment: function(bidCpm) {
                        return bidCpm * 2;                      //Audience TMP adjustment * 2.0
                    }
                },
                pubmatic: {
                    bidCpmAdjustment: function(bidCpm) {
                        return bidCpm * msCorrection * 1;
                    }
                },
                openx: {
                    bidCpmAdjustment: function(bidCpm) {
                        return bidCpm * msCorrection * 1;
                    }
                }
            };

            const customConfigObject = { //price buckets as set up in Massarius Ad Manager
              "buckets" : [{
                  "precision": 2, 
                  "min" : 0,
                  "max" : 2.50,
                  "increment" : 0.01  
                },
                {
                  "precision": 2,
                  "min" : 2.50,
                  "max" : 10,
                  "increment" : 0.10  
                },
                {
                  "precision": 2,
                  "min" : 10,
                  "max" : 20,
                  "increment" : 0.2  
                },
                {
                  "precision": 2,
                  "min" : 20,
                  "max" : 50,
                  "increment" : 0.5   
                }]
            };

            pbjs.que.push(function() {
                pbjs.addAdUnits(adUnits);                 
                pbjs.aliasBidder('improvedigital', 'weborama'); //You can also call improvedigital by bidder name weborama
                pbjs.aliasBidder('appnexus', 'tmp1');
                pbjs.aliasBidder('appnexus', 'tmp2');
                pbjs.setConfig({
                    sizeConfig: [{
                        'mediaQuery': '(min-width: 1025px)', //if viewport > 1025
                        'sizesSupported': [[1800, 1000],[970, 1000],[970, 500],[970, 250],[970, 90],[728, 90],[300, 250],[160, 600],[120, 600],[300, 600]], //>call these sizes
                        'labels': ['desktop'] //label impression as 'desktop', can be used for label targeting
                    }, {
                        'mediaQuery': '(min-width: 769px) and (max-width: 1024px)',
                        'sizesSupported': [[970, 250],[728, 90],[300, 250],[160, 600],[120, 600]],
                        'labels': ['tablet']
                    }, {
                        'mediaQuery': '(min-width: 0px) and (max-width: 768px)',
                        'sizesSupported': [[300, 250],[320, 240],[300, 600],[300, 50],[320, 50],[300, 100],[320, 100]],
                        'labels': ['phone']
                    }],
                    priceGranularity: customConfigObject, //use defined buckets
                    enableSendAllBids: true, //send all bids to the ad server (not only winning bid)
                    bidderSequence: "random", //call bidders in random order
                    bidderTimeout: PREBID_TIMEOUT, //time bidders have to respond
                    debug: false, //turn on debugger in inspect > console
                    userSync: {
                        syncDelay: 3000, //user syncs will be dropped 3s after page load (not instantly, to avoid interfering with loading important stuff )
                        syncEnabled: true, //user syncs enabled
                        syncsPerBidder: 5, //5 syncs per bidder
                        iframeEnabled: true //serve user syncs in separate iframes
                    },
                    "currency": {
                        "adServerCurrency": "EUR" //call bids in EUR
                    }
                });

                pbjs.requestBids({
                    bidsBackHandler: initAdserver,
                    timeout: PREBID_TIMEOUT
                });
            });

            function initAdserver() {
                if (pbjs.initAdserverSet) return;
                pbjs.initAdserverSet = true;
                googletag.cmd.push(function() {
                    pbjs.que.push(function() {
                        pbjs.setTargetingForGPTAsync();
                        googletag.pubads().refresh(); //release ad server when bids are back
                    });
                });
            }

            setTimeout(function() {
                initAdserver();
            }, FAILSAFE_TIMEOUT);


            googletag.cmd.push(function() {
                //define random value for split testing
                var msCtrl=Math.floor(100*Math.random()+1);1<=msCtrl&&msCtrl<=50&&(msRandom="a"),50<msCtrl&&msCtrl<=80&&(msRandom="b"),80<msCtrl&&msCtrl<=90&&(msRandom="c"),90<msCtrl&&msCtrl<=95&&(msRandom="e"),95<msCtrl&&(msRandom="f");

                googletag.defineSlot('/13436254/TVGids.tv_ROS_Header', HeaderSizes, 'div-gpt-ad-1534165407033-0').addService(googletag.pubads());
                googletag.defineSlot('/13436254/TVGids.tv_ROS_MPU1', MPU1Sizes, 'div-gpt-ad-1534165407033-2').addService(googletag.pubads());
                googletag.defineSlot('/13436254/TVGids.tv_ROS_MPU2', MPU2Sizes, 'div-gpt-ad-1534165407033-3').addService(googletag.pubads());
                googletag.defineSlot('/13436254/TVGids.tv_ROS_Sky', SkySizes, 'div-gpt-ad-1534165407033-4').addService(googletag.pubads());
                googletag.defineSlot('/13436254/TVGids.tv_ROS_BTF', BTFSizes, 'div-gpt-ad-1534165407033-5').addService(googletag.pubads());
                googletag.pubads().setTargeting('hb', ['true']);
                googletag.pubads().setTargeting('split_group', [msRandom]); //add random value as key/value to ad manager
                googletag.pubads().enableLazyLoad({ //enable lazyload
                  fetchMarginPercent: 50, //fetch ads when user is 0.5 viewports away
                  renderMarginPercent: 25,  //render ads when user is 0.25 viewports away
                  mobileScaling: 2.0   //double these values for mobile (due to slower connection + smaller screen)
                });
                googletag.pubads().enableSingleRequest();
               // googletag.pubads().collapseEmptyDivs(); //collapseEmptyDivs can't be combined with gpt lazyload
                googletag.pubads().setCentering(true);
                googletag.enableServices();
            });
        </script>

        <!-- CMP LOGIC -->
<script>
    var consentForAds;
    var checkConsent = function() {
        console.log('Faktor.io CMP: checkConsent');
        window.__cmp('getVendorConsents', undefined, function(data) {
            var newConsentForAds = (data.purposeConsents[1] && data.purposeConsents[2] && data.purposeConsents[3] && data.purposeConsents[4] && data.purposeConsents[5])
            console.log('consentForAds: ' + newConsentForAds);
            if (consentForAds !== newConsentForAds) {
                consentForAds = newConsentForAds;
                googletag.cmd.push(function() {
                    googletag.pubads().setRequestNonPersonalizedAds(consentForAds ? 0 : 1); //request non-personalized ads for no consent
                });
                window.__cmp('getConsentData', undefined, function(data) {
                    googletag.cmd.push(function() {
                        googletag.pubads().setTargeting('iab_string', [data.consentData]); //send IAB string KV to DFP
                        googletag.pubads().setTargeting('consent', [consentForAds ? 1 : 0]); //send consent 1/0 KV to DFP
                        googletag.pubads().setTargeting('rev_consent', [consentForAds ? 0 : 1]); //send rev_consent (equal to NPA) KV to DFP
                        googletag.pubads().refresh(); //fetch the ads
                    });
                });
            }
        });
    }
    // refresh ads on pressing accept button (also after changing via fingerprint)
    window.__cmp('addEventListener', 'acceptAllButtonClicked', function(data) {
        checkConsent();
    });
    // refresh ads on pressing exit button (also after changing via fingerprint)
    window.__cmp('addEventListener', 'exitButtonClicked', function(data) {
        checkConsent();
    });
    //listener for CMP ready - refresh ads when consent is found
    window.__cmp('addEventListener', 'cmpReady', function(data) {
        checkConsent();
    });
</script>
</head>
<body>
    <h5>Money Maker1 :</h5>
    <div id='div-gpt-ad-1534165407033-0'>
        <script type='text/javascript'>
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1534165407033-0');
            });

        </script>
    </div>

<!--     <h5>Money Maker2:</h5>
    <div id='div-gpt-ad-1534165407033-2'>
        <script type='text/javascript'>
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1534165407033-2');
            });

        </script>
    </div>

    <h5>Money Maker3:</h5>
    <div id='div-gpt-ad-1534165407033-3'>
        <script type='text/javascript'>
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1534165407033-3');
            });

        </script>
    </div>

    <h5>Money Maker4:</h5>
    <div id='div-gpt-ad-1534165407033-4'>
        <script type='text/javascript'>
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1534165407033-4');
            });

        </script>
    </div>

    <h5>Money Maker4:</h5>
    <div id='div-gpt-ad-1534165407033-5'>
        <script type='text/javascript'>
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1534165407033-5');
            });

        </script>
    </div>
 -->
</body>
</html>

